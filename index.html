<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FLYMILY — מנהל נסיעות</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />

  <link rel="stylesheet" href="./style.css" />

  <link rel="icon" type="image/png" href="./flymily-logo.png">

  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/advancedFormat.js"></script>
</head>
<body data-theme="light">
  <div class="app">
    <header>
      <div class="brand" style="display:flex;align-items:center;gap:8px"><img src="./flymily-logo.png" alt="FLYMILY" style="height:28px;vertical-align:middle"> <span class="brand-text">FLYMILY</span></div>
      <div class="spacer"></div>
      <span id="userBadge" class="muted" style="display:none"></span>
      <button id="btnAllTrips" class="btn" style="display:none">כל הנסיעות</button>
      <button id="btnTheme" class="btn">מצב כהה/בהיר</button>
      <button id="btnLogin" class="btn primary">התחברות / הרשמה</button>
      <button id="btnLogout" class="btn" style="display:none">התנתקות</button>
    </header>

    
<div id="loginScreen" class="login-screen" style="display:none">
  <div class="login-card">
    <img src="./flymily-logo.png" alt="FLYMILY" style="height:96px;margin-bottom:12px;opacity:.95">
    <h1>כניסה ל‑FLYMILY</h1>
    <p class="muted" style="margin-top:-6px">נהל ותכנן טיולים – בעברית וב־RTL</p>
    <label>אימייל<input id="lsEmail" type="email" class="input" placeholder="name@example.com"/></label>
    <label>סיסמה<input id="lsPass" type="password" class="input" placeholder="••••••••"/></label>
    <div class="row" style="margin-top:8px">
      <button id="lsSignIn" class="btn primary">כניסה</button>
      <button id="lsSignUp" class="btn">הרשמה</button>
      <button id="lsReset" class="btn">איפוס סיסמה</button>
    </div>
    <p id="lsError" class="muted" style="color:var(--danger);min-height:1.5em"></p>
  </div>
</div>
<div class="container home-mode">
      <aside class="sidebar" id="sidebar">
        <div class="section-title">
          <h2 style="margin:0">הנסיעות שלי</h2>
          <div class="spacer"></div>
      <span id="userBadge" class="muted" style="display:none"></span>
          <button id="btnNewTrip" class="btn primary">+ נסיעה חדשה</button>
        </div>
        <div class="list-actions">
          <input id="searchTrips" class="input" placeholder="חפש נסיעה / מילה" />
          <button id="btnSortTrips" class="btn">מיין תאריך יציאה</button>
        </div>
        <div class="list-actions">
          <button id="btnViewGrid" class="btn active">גלריה</button>
          <button id="btnViewList" class="btn">רשימה</button>
        </div>
        <div id="tripList" class="grid" aria-live="polite"></div>
      </aside>

      <main class="content" id="main">
        <nav class="tabs" id="tabs" style="display:none">
          <button data-tab="overview" class="active">הצג הכל</button>
          <button data-tab="meta">נתוני נסיעה</button>
          <button data-tab="expenses">הוצאות</button>
          <button data-tab="journal">יומן יומי</button>
          <button data-tab="map">מפה</button>
          <button data-tab="share">ייבוא / ייצוא / שיתוף</button>
        </nav>

        <section id="view-overview" class="tabview" hidden>
          <h2>סקירה כללית</h2>
          <div class="cards">
            <div class="card">
              <h3>נתוני נסיעה</h3>
              <div id="metaSummary" class="muted"></div>
            </div>
            <div class="card">
              <h3>הוצאות (אחרונות)</h3>
              <table>
                <thead><tr><th>תיאור</th><th>קטגוריה</th><th>סכום</th><th>תאריך</th></tr></thead>
                <tbody id="tblRecentExpenses"></tbody>
              </table>
            </div>
            <div class="card">
              <h3>יומן יומי (אחרונים)</h3>
              <table>
                <thead><tr><th>תאריך</th><th>מקום</th><th>תיאור</th></tr></thead>
                <tbody id="tblRecentJournal"></tbody>
  ...
</table>
            </div>
            <div class="card">
              <h3>מיקומים אחרונים</h3>
              <div id="miniMap" style="height:280px" class="leaflet-container"></div>
            </div>
          </div>
        </section>

        <section id="view-meta" class="tabview" hidden>
  <h2>נתוני נסיעה</h2>
  <div class="card meta-single">
    <div class="row dest-row">
      <label class="dest-col">יעד
        <input id="metaDestination" class="input"/>
      </label>
      <button id="btnVerifyOnMap" class="btn map-btn">בדוק במפה</button>
    </div>
    <div class="row date-row">
      <label>תאריך התחלה <input type="date" id="metaStart" class="input"></label>
      <label>תאריך סיום <input type="date" id="metaEnd" class="input"></label>
      <label class="people-input">משתתפים (מופרדים בפסיק)<input id="metaPeople" class="input"/></label>
      <div class="multi-types">
        <div class="lbl">סוגי טיול</div>
        <div class="chips">
          <button class="chip metaType" data-value="עירוני">עירוני</button>
          <button class="chip metaType" data-value="בטן גב">בטן גב</button>
          <button class="chip metaType" data-value="סקי">סקי</button>
          <button class="chip metaType" data-value="טרק">טרק</button>
          <button class="chip metaType" data-value="אחר">אחר</button>
        </div>
      </div>
    </div>
    <div class="budget-block">
      <h3>תקציב</h3>
      <div class="row budget-row">
        <label>USD <input id="bUSD" type="text" class="input money"></label>
        <label>EUR <input id="bEUR" type="text" class="input money"></label>
        <label>ILS <input id="bILS" type="text" class="input money"></label>
      </div>
      <div class="row budget-actions-row">
        <button id="btnBudgetEdit" class="btn">קבע תקציב</button>
        <button id="btnSaveMeta" class="btn primary">שמור</button>
      </div>
    </div>
  </div>
</section>

        <section id="view-expenses" class="tabview" hidden>
          <div class="section-title"><h2 style="margin:0">ניהול תקציב</h2></div>
          <div class="cards">
            <div class="card" id="expenseSummary"></div>
          </div>
          <div class="list-actions">
            <button id="btnAddExpense" class="btn primary">הוסף הוצאה</button>
            <button id="btnSortExpenses" class="btn">מיין</button>
          </div>
          <div class="card">
            <table>
              <thead><tr><th></th><th>תיאור</th><th>קטגוריה</th><th>סכום</th><th>מטבע</th><th>תאריך</th></tr></thead>
              <tbody id="tblExpenses"></tbody>
            </table>
          </div>
        </section>

        <section id="view-journal" class="tabview" hidden>
          <div class="list-actions">
            <button id="btnAddJournal" class="btn primary">הוסף רישום</button>
            <button id="btnSortJournal" class="btn">מיין</button>
          </div>
          <div class="card">
            <table>
              <thead><tr><th></th><th>תאריך</th><th>מקום</th><th>תיאור</th></tr></thead>
              <tbody id="tblJournal"></tbody>
            </table>
          </div>
        </section>

        <section id="view-map" class="tabview" hidden>
          <div style="position:relative">
            <div class="map-toolbar">
              <button id="btnToggleSpent" class="btn">איפה ביזבזתי</button>
              <button id="btnToggleVisited" class="btn">איפה טיילתי</button>
            </div>
            <div id="bigMap" class="leaflet-container"></div>
          </div>
        </section>

        <section id="view-share" class="tabview" hidden>
          <h2>ייבוא / ייצוא / שיתוף</h2>
          <div class="cards">
            <div class="card">
              <h3>ייבוא JSON</h3>
              <input type="file" id="importFile" accept="application/json" class="input"/>
              <div class="row"><button id="btnImport" class="btn primary">ייבא</button></div>
            </div>
            <div class="card">
              <h3>ייצוא</h3>
              <div class="row">
                <select id="exportWithExpenses" class="input"><option value="yes">עם הוצאות</option><option value="no">בלי הוצאות</option></select>
              </div>
              <div class="row">
                <button id="btnExportPDF" class="btn">PDF</button>
                <button id="btnExportExcel" class="btn">Excel</button>
                <button id="btnExportWord" class="btn">Word</button>
                <button id="btnExportGPX" class="btn">GPX</button>
              </div>
            </div>
            <div class="card">
              <h3>שיתוף</h3>
              <div class="row">
                <button id="btnEnableShare" class="btn">הפעל שיתוף</button>
                <button id="btnDisableShare" class="btn danger">בטל שיתוף</button>
              </div>
              <div class="row">
                <input id="shareLink" class="input" readonly placeholder="לחץ על 'הפעל שיתוף'" />
                <button id="btnCopyShare" class="btn">העתק קישור</button>
              </div>
              <p class="muted">קישור שיתוף יציג <strong>יומן יומי</strong> ו<strong>מפה</strong> בלבד, עם סימוני "איפה טיילתי" בלבד.</p>
            </div>
          </div>
        </section>

        <section id="view-welcome" class="tabview">
          <div class="trip-card">
            <img src="./flymily-logo.png" alt="FLYMILY" style="height:42px;opacity:.9"><h2>ברוכים הבאים ל-FLYMILY</h2>
            <p class="muted">התחברו כדי לנהל, לעקוב, ולשתף טיולים — בעברית ובכיווניות RTL.</p>
          </div>
        </section>
      </main>
    </div>
  </div>

  <dialog id="authModal" class="modal">
    <header style="display:flex;align-items:center;gap:8px"><img src="./flymily-logo.png" alt="FLYMILY" style="height:22px"><strong>התחברות / הרשמה</strong></header>
    <div class="body">
      <label>אימייל<input id="authEmail" type="email" class="input" placeholder="name@example.com"/></label>
      <label>סיסמה<input id="authPass" type="password" class="input" placeholder="••••••••"/></label>
      <p id="authError" class="muted" style="color:var(--danger);"></p>
    </div>
    <div class="footer">
      <button id="authSignIn" class="btn primary">כניסה</button>
      <button id="authSignUp" class="btn">הרשמה</button>
      <button id="authReset" class="btn">איפוס סיסמה</button>
      <button id="authCancel" class="btn">ביטול</button>
    </div>
  </dialog>

  <dialog id="tripModal" class="modal">
    <header><strong>נסיעה חדשה</strong></header>
    <div class="body">
      <label>יעד<input id="tripDest" class="input"/></label>
      <div class="row"><label>תאריך התחלה<input type="date" id="tripStart" class="input"></label><label>תאריך סיום<input type="date" id="tripEnd" class="input"></label></div>
    </div>
    <div class="footer">
      <button id="tripSave" class="btn primary">שמור</button>
      <button id="tripCancel" class="btn">ביטול</button>
    </div>
  </dialog>

  <dialog id="expenseModal" class="modal">
    <header><strong>הוצאה</strong></header>
    <div class="body">
      <label>תיאור<input id="expDesc" class="input"/></label>
      <label>קטגוריה
        <select id="expCat" class="input">
          <option value="">בחר...</option>
          <option>טיסה</option>
          <option>לינה</option>
          <option>תקשורת</option>
          <option>רכב</option>
          <option>ביטוח בריאות</option>
          <option>מזון - מסעדות / סופר</option>
          <option>קניות</option>
          <option>אטרקציות</option>
          <option>אחר</option>
        </select>
      </label>
      <div class="row"><label>סכום<input id="expAmount" type="text" class="input money"></label><label>מטבע<select id="expCurr" class="input"><option>USD</option><option>EUR</option><option>ILS</option></select></label></div>
      <div class="row location-row">
        <label>מיקום<input id="expLocationName" class="input" placeholder="בחר עפ״י שם"/></label>
        <button id="btnSelectExpLocation" class="btn location-btn">בחר ע"ג מפה</button>
        <button id="btnUseCurrentExp" class="btn location-btn">בחר מיקום נוכחי</button>
        <input type="hidden" id="expLat" />
        <input type="hidden" id="expLng" />
      </div>
    </div>
    <div class="footer">
      <button id="expSave" class="btn primary">שמור</button>
      <button id="expDelete" class="btn danger" style="display:none">מחק</button>
      <button id="expCancel" class="btn">ביטול</button>
    </div>
  </dialog>



<dialog id="rowMenuModal" class="modal">
  <header><strong>פעולות</strong></header>
  <div class="body"><p class="muted">בחר פעולה עבור הפריט.</p></div>
  <div class="footer">
    <button id="rowMenuEdit" class="btn">ערוך</button>
    <button id="rowMenuDelete" class="btn danger">מחק</button>
    <button id="rowMenuCancel" class="btn">ביטול</button>
  </div>
</dialog>


  <dialog id="journalModal" class="modal">
    <header><strong>רישום יומן</strong></header>
    <div class="body">
      <label>תיאור<textarea id="jrText" class="input"></textarea></label>
      <div class="row location-row">
        <label>מיקום<input id="jrLocationName" class="input" placeholder="בחר עפ״י שם"/></label>
        <button id="btnSelectJrLocation" class="btn location-btn">בחר ע"ג מפה</button>
        <button id="btnUseCurrentJr" class="btn location-btn">בחר מיקום נוכחי</button>
        <input type="hidden" id="jrLat" />
        <input type="hidden" id="jrLng" />
      </div>
    </div>
    <div class="footer">
      <button id="jrSave" class="btn primary">שמור</button>
      <button id="jrDelete" class="btn danger" style="display:none">מחק</button>
      <button id="jrCancel" class="btn">ביטול</button>
    </div>
  </dialog>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <dialog id="unsavedChangesModal" class="modal">
    <header><strong>שינויים שלא נשמרו</strong></header>
    <div class="body">
        <p>ישנם שינויים שלא נשמרו. האם תרצה לשמור אותם לפני שאתה עוזב את הדף?</p>
    </div>
    <div class="footer">
        <button id="unsavedSave" class="btn primary">שמור שינויים</button>
        <button id="unsavedDiscard" class="btn danger">התעלם משינויים</button>
        <button id="unsavedCancel" class="btn">ביטול</button>
    </div>
  </dialog>
  
  <dialog id="mapSelectModal" class="modal">
    <header><strong>בחר מיקום על המפה</strong></header>
    <div class="body">
      <div id="selectMap" class="leaflet-container" style="height:350px"></div>
    </div>
    <div class="footer">
      <button id="selectMapSave" class="btn primary">שמור מיקום</button>
      <button id="selectMapCancel" class="btn">ביטול</button>
    </div>
  </dialog>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./script.js"></script>

<dialog id="confirmDeleteModal" class="modal">
  <header><strong>לאשר מחיקה?</strong></header>
  <div class="body"><p>האם אתה בטוח שברצונך למחוק? הפעולה אינה ניתנת לביטול.</p></div>
  <div class="footer">
    <button id="confirmDeleteYes" class="btn danger">מחק</button>
    <button id="confirmDeleteNo" class="btn">ביטול</button>
  </div>
</dialog>
</body>
</html>